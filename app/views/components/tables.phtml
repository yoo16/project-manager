
<a class="change-list-col" target-class=".db-table" data="1" href="#"><i class="fa fa-list"></i></a>
<a class="change-list-col" target-class=".db-table" data="2" href="#"><i class="fa fa-th"></i></a>
<?= count($this->pg_classes) ?> tables

<? if ($this->pg_classes): ?>
<div class="row">
  <? foreach ($this->pg_classes as $pg_class_id => $pg_class): ?>
  <div class="db-table col-6 mb-3">
    <div id="<?= $pg_class_id ?>" class="card">

      <div class="card-header">
        <div><?= $pg_class['tablename'] ?></div>
        <div><?= $pg_class['comment'] ?></div>
      </div>

      <div>
        <table class="table">
          <? foreach ($pg_class['pg_attribute'] as $attnum => $pg_attribute): ?>
          <tr id="<?= $pg_class_id ?>-<?= $attnum ?>">
            <td>
              <small><?= $pg_attribute['attname'] ?></small>
            </td>
            <td>
              <? if ($pg_attribute['comment']): ?>
              <small><?= $pg_attribute['comment'] ?></small>
              <? else: ?>
              <small><span class="badge badge-danger">undefined</span></small>
              <? endif ?>
            </td>
            <td>
              <small><?= $pg_attribute['udt_name'] ?></small>
            </td>
          </tr>
        <? endforeach ?>
      </table>
    </div>

    <div class="">
      <table class="table">
      <tr>
        <th colspan="3">constraint</th>
      </tr>

        <? if ($pg_class['pg_constraint']): ?>
        <? foreach ($pg_class['pg_constraint'] as $pg_constraint): ?>
        <? if ($pg_constraint['confkey']): ?>

        <? foreach ($pg_constraint['confkey'] as $foreign_attnum): ?>
        <tr>
          <td>
            <small>
              <a href="#<?= $pg_constraint['confrelid'] ?>-<?= $foreign_attnum ?>"><?= $pg_constraint['conname'] ?></a>
            </small>
          </td>
          <td>
            <small>
              <?= $this->pg_classes[$pg_constraint['confrelid']]['relname'] ?>
              :
              <?= $this->pg_classes[$pg_constraint['confrelid']]['pg_attribute'][$foreign_attnum]['attname'] ?>
            </small>
          </td>
        </tr>
      <? endforeach ?>

    <? else: ?>

    <? if ($pg_constraint['conkey']): ?>
    <? foreach ($pg_constraint['conkey'] as $attnum): ?>
    <tr>
      <td>
        <small><?= $pg_constraint['conname'] ?></small>
      </td>
      <td>
        <small><?= $this->pg_classes[$pg_constraint['conrelid']]['pg_attribute'][$attnum]['attname'] ?></small>
      </td>
    </tr>
  <? endforeach ?>
<? endif ?>

<? endif ?>
<? endforeach ?>
<? endif ?>
</table>

</div>
</div>
</div>
<? endforeach ?>
</div>
<? endif ?>
