<? include('_header.phtml') ?>

<div>
  <form action="<?= url_for('create_from_db') ?>" method="post">
    <a class="btn btn-primary" href="#" data-toggle="modal" data-target="#add-table-window"><?= LABEL_ADD ?></a>
    <a href="<?= url_for('project/list') ?>" class="btn btn-secondary"><?= LABEL_BACK ?></a>
    <input class="btn btn-warning" type="submit" value="Import From DB">
    <input type="hidden" name="project_id" value="<?= $this->project['id'] ?>">
  </form>
</div>

<? include('add_table_window.phtml'); ?>

<table class="table">
  <tr>
    <th></th>
    <th>name</th>
    <th>label</th>
    <th>DB</th>
    <th></th>
  </tr>
  <? foreach ($this->models as $model): ?>
  <tr>
    <td><a class="btn btn-secondary" href="<?= url_for('edit', $model['id']) ?>"><?= LABEL_EDIT ?></a></td>
    <td>
      <a href="<?= url_for('attribute/', array('model_id' => $model['id'])) ?>"><?= $model['name'] ?></a>
      <div><?= $model['pg_class_id'] ?></div>
    </td>
    <td><?= $model['label'] ?></td>
    <td>
      <? if ($model['pg_class']): ?>
      <? if ($model['pg_class_id'] == $model['pg_class']['pg_class_id']): ?>
      <label class="badge badge-pill badge-success">connected</label>

    <? else: ?>
    <label class="badge badge-pill badge-danger">pg_class_id error</label>
  <? endif ?>
  <div><?= $model['pg_class']['pg_class_id'] ?></div>
<? else: ?>
<form action="<?= url_for('add_table', $model['id']) ?>" method="post">
  <input class="btn btn-primary" type="submit" value="<?= LABEL_ADD ?>">
  <input type="hidden" name="model_id" value="<?= $model['id'] ?>">
  <input type="hidden" name="table_name" value="<?= $model['name'] ?>">
</form>
<? endif ?>
</td>
<td>
  <div><?= $model['pg_table']['relname'] ?></div>
  <div><?= $model['pg_table']['relfilenode'] ?></div>
</td>
</tr>
<? endforeach ?>
</table>
